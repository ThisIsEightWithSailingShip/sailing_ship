<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Expiry Test</title>
</head>
<body>
<h1>Token Expiry Test</h1>

<div id="tokenInfo">
    <p>현재 토큰:</p>
    <p id="currentToken"></p>
    <p>토큰 만료 시간:</p>
    <p id="expiryTime"></p>
</div>

<button onclick="testTokenExpiry()">토큰 만료 테스트</button>

<script>
    // 로컬 스토리지에서 토큰 가져오기
    const currentToken = localStorage.getItem("accessToken");
    const expiryTime = localStorage.getItem("expiryTime");

    // 가져온 토큰 정보를 화면에 표시
    document.getElementById("currentToken").innerText = currentToken || "토큰 없음";
    document.getElementById("expiryTime").innerText = expiryTime || "만료 시간 없음";

    function testTokenExpiry() {
        if (!currentToken) {
            alert("현재 토큰이 없습니다.");
            return;
        }

        // 토큰 만료 시간 확인
        const expiry = new Date(expiryTime).getTime();
        const currentTime = new Date().getTime();

        if (currentTime < expiry) {
            alert("토큰이 아직 유효합니다.");
        } else {
            alert("토큰이 만료되었습니다.");

            // 만료된 토큰을 새로운 토큰으로 교체하는 로직 추가하기

            // 여기에 로컬 스토리지에서 새로운 토큰을 가져오고 화면에 업데이트하는 코드를 추가할 수 있습니다.
            // 예를 들어, fetch 요청을 사용하여 서버에서 새로운 토큰을 가져오고,
            // 가져온 토큰을 로컬 스토리지에 저장하고 화면을 업데이트할 수 있습니다.
        }
    }
</script>

<!-- 헤더에 액세스 토큰 추가 -->
<script>
    const currentToken = localStorage.getItem("accessToken");
    if (currentToken) {
        const headers = {
            'Authorization': 'Bearer ' + currentToken
        };

        // 현재 페이지가 admin 페이지인지 확인
        const isAdminPage = window.location.pathname.includes('/admin');

        if (isAdminPage) {
            // admin 페이지인 경우 헤더에 액세스 토큰 추가
            const script = document.createElement('script');
            script.innerHTML = `
                window.onload = function() {
                    const headers = ${JSON.stringify(headers)};
                    const elements = document.getElementsByTagName('head');
                    if (elements && elements.length > 0) {
                        const head = elements[0];
                        const scriptElement = document.createElement('script');
                        scriptElement.innerHTML = "var headers = " + JSON.stringify(headers);
                        head.appendChild(scriptElement);
                    }
                }
            `;
            document.body.appendChild(script);
        }
    }
</script>

</body>
</html>
